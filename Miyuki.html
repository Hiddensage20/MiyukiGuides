<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guía de Pasos Miyuki</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Fondo gris claro */
        }
        /* Estilos adicionales para el modal/popup */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6); /* Fondo semitransparente oscuro */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 999; /* Asegura que esté por encima de todo */
        }
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 90%;
            position: relative;
            z-index: 1000;
            max-height: 80vh; /* Altura máxima del modal */
            overflow-y: auto; /* Permite scroll si el contenido es largo */
        }
        .close-button {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            color: #4a5568; /* gray-700 */
        }
        .close-button:hover {
            color: #2d3748; /* gray-900 */
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="bg-white p-6 rounded-lg shadow-xl max-w-lg w-full text-center flex flex-col items-center">
        
        <div id="initial-instructions" class="mb-8 text-left text-gray-700 w-full">
            <h2 class="text-2xl font-bold text-indigo-800 mb-4">Paso a paso para tejer VIRGEN en Pepa Miyuki</h2>
            
            <p class="mb-4">
                ¡Bienvenida/o a esta guía detallada para crear tu pieza de Miyuki! Sigue los pasos cuidadosamente para lograr un resultado hermoso.
            </p>

            <h3 class="text-xl font-semibold text-indigo-700 mb-2">Glosario de Letras</h3>
            <ul class="list-disc list-inside mb-4 ml-4">
                <li><span class="font-bold">D</span> = Dorado</li>
                <li><span class="font-bold">N</span> = Negro</li>
                <li><span class="font-bold">P</span> = Piel</li>
                <li><span class="font-bold">V</span> = Verde</li>
                <li><span class="font-bold">C</span> = Café</li>
                <li><span class="font-bold">R</span> = Rojo</li>
            </ul>

            <h3 class="text-xl font-semibold text-indigo-700 mb-2">Explicación de Reducción</h3>
            <p class="mb-2">
                Hay dos tipos de reducción:
            </p>
            <p class="mb-4">
                1. Cuando decimos agregar una pepa y luego poner el hilo por la misma, notarás que al poner la última pepa queda un espacio vacío. Meterás la aguja por la pepa que queda justo encima donde te quedó el hilo y agregarás la pepa indicada como si fueras a hacer una hilera. Quedarás con el hilo justo debajo de la última hilera. Meterás la aguja hacia donde está la pepa en la pepa justo detrás donde te queda el hilo. Si tienes el hilo apuntando hacia arriba justo a la derecha habrán dos pepas: la que acabas de poner y una detrás de la que pusiste. Meterás la aguja hacia arriba por la anterior a la que pusiste y por último el hilo por la pepa que metiste.
            </p>
            <p class="mb-4">
                2. Después de poner la última pepa antes de una reducción, formas una especie de escalón y el hilo queda en la última pepa de la fila anterior. Meterás el hilo justo en la pepa anterior por la que salió el hilo. Ahora verás la penúltima columna. Desde la pepa que metiste hacia lo que ya está terminado habrán 3 pepas contando la que pusiste. Meterás la aguja en dirección a donde sale el hilo en la tercera, devolverás por la segunda en dirección contraria y por último metes la aguja en la que pusiste.
            </p>
            <hr class="my-6 border-t-2 border-gray-300">
        </div>
        <div id="step-display" class="text-3xl font-bold text-indigo-700 mb-6">Paso 1</div>

        <img id="step-image" src="images/1.jpg" alt="Imagen del paso actual" class="w-[245px] h-auto rounded-lg shadow-md mb-8 mx-auto">

        <div id="pattern-display" class="text-xl text-gray-800 mb-8 px-4 leading-relaxed">
            Prepara tu espacio de trabajo.
        </div>

        <div class="flex justify-center space-x-4 w-full mt-auto py-4">
            <button id="prev-button" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-6 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50">
                Anterior
            </button>
            <button id="next-button" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50">
                Siguiente
            </button>
        </div>
    </div>

    <div id="reduction-type2-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <span class="close-button" id="close-modal-button">&times;</span>
            <h3 class="text-2xl font-bold text-indigo-800 mb-4">Explicación de Reducción Tipo 2</h3>
            <p class="text-gray-800 text-lg">
                Después de poner la última pepa antes de una reducción, formas una especie de escalón y el hilo queda en la última pepa de la fila anterior. Meterás el hilo justo en la pepa anterior por la que salió el hilo. Ahora verás la penúltima columna. Desde la pepa que metiste hacia lo que ya está terminado habrán 3 pepas contando la que pusiste. Meterás la aguja en dirección a donde sale el hilo en la tercera, devolverás por la segunda en dirección contraria y por último metes la aguja en la que pusiste.
            </p>
        </div>
    </div>
    <script>
        // Array de pasos con sus patrones e imágenes
        const steps = [
            {
                pattern: "Prepara tu espacio de trabajo.", // Este será el contenido del Paso 1 (índice 0)
                imageUrl: "images/1.jpg"
            },
            {
                pattern: "D 2N 10P 1N 1D 4V", // Paso 2 (índice 1)
                imageUrl: "images/1.jpg"
            },
            {
                pattern: "D N 5P N", // Paso 3 (índice 2)
                imageUrl: "images/2.jpg"
            },
            {
                pattern: "D 3P 2C P N V", // Paso 4 (índice 3)
                imageUrl: "images/3.jpg"
            },
            {
                pattern: "V D N 3C P C N", // Paso 5 (índice 4)
                imageUrl: "images/4.jpg"
            },
            {
                pattern: "D 2C 4P N V", // Paso 6 (índice 5)
                imageUrl: "images/5.jpg"
            },
            {
                pattern: "V D 6P N", // Paso 7 (índice 6)
                imageUrl: "images/6.jpg"
            },
            {
                pattern: "D 3P 2N P N V", // Paso 8 (índice 7)
                imageUrl: "images/7.jpg"
            },
            {
                pattern: "V D 2P N 3P N", // Paso 9 (índice 8)
                imageUrl: "images/8.jpg"
            },
            {
                pattern: "D 2N 4P N V", // Paso 10 (índice 9)
                imageUrl: "images/9.jpg"
            },
            {
                pattern: "V D 4P C 2N", // Paso 11 (índice 10)
                imageUrl: "images/10.jpg"
            },
            {
                pattern: "D C 5P N V", // Paso 12 (índice 11)
                imageUrl: "images/11.jpg"
            },
            {
                pattern: "2D 4P C P N", // Paso 13 (índice 12)
                imageUrl: "images/12.jpg"
            },
            {
                pattern: "D C P C 3P N V", // Paso 14 (índice 13)
                imageUrl: "images/13.jpg"
            },
            {
                pattern: "V D 5P C N", // Paso 15 (índice 14)
                imageUrl: "images/14.jpg"
            },
            {
                pattern: "D N 5P N V", // Paso 16 (índice 15)
                imageUrl: "images/15.jpg"
            },
            {
                pattern: "V D 2P 2C P C D", // Paso 17 (índice 16) - Tu código original lo tenía como Paso 16
                imageUrl: "images/16.jpg"
            },
            // ********************************************************************************
            // Este es el paso 18 (índice 17) donde quieres el pop-up
            {
                pattern: "REDUCCION (Reducción Tipo 2)", // **ESTE ES EL TEXTO CLAVE QUE ACTIVARÁ EL POP-UP**
                imageUrl: "images/18.jpg" // Asegúrate de tener esta imagen
            },
            // ********************************************************************************
            {
                pattern: "Paso 19: Patrón de ejemplo para el paso 19",
                imageUrl: "images/19.jpg"
            },
            {
                pattern: "Paso 20: Patrón de ejemplo para el paso 20",
                imageUrl: "images/20.jpg"
            },
            {
                pattern: "Paso 21: Patrón de ejemplo para el paso 21",
                imageUrl: "images/21.jpg"
            },
            {
                pattern: "Paso 22: Patrón de ejemplo para el paso 22",
                imageUrl: "images/22.jpg"
            },
            {
                pattern: "Paso 23: Patrón de ejemplo para el paso 23",
                imageUrl: "images/23.jpg"
            },
            {
                pattern: "Paso 24: Patrón de ejemplo para el paso 24",
                imageUrl: "images/24.jpg"
            },
            {
                pattern: "Paso 25: Patrón de ejemplo para el paso 25",
                imageUrl: "images/25.jpg"
            },
            {
                pattern: "Paso 26: Patrón de ejemplo para el paso 26",
                imageUrl: "images/26.jpg"
            },
            {
                pattern: "Paso 27: Patrón de ejemplo para el paso 27",
                imageUrl: "images/27.jpg"
            },
            {
                pattern: "Paso 28: Patrón de ejemplo para el paso 28",
                imageUrl: "images/28.jpg"
            },
            {
                pattern: "Paso 29: Patrón de ejemplo para el paso 29",
                imageUrl: "images/29.jpg"
            },
            {
                pattern: "Paso 30: Patrón de ejemplo para el paso 30",
                imageUrl: "images/30.jpg"
            },
            {
                pattern: "Paso 31: Patrón de ejemplo para el paso 31",
                imageUrl: "images/31.jpg"
            },
            {
                pattern: "Paso 32: Patrón de ejemplo para el paso 32",
                imageUrl: "images/32.jpg"
            },
            {
                pattern: "Paso 33: Patrón de ejemplo para el paso 33",
                imageUrl: "images/33.jpg"
            },
            {
                pattern: "Paso 34: Patrón de ejemplo para el paso 34",
                imageUrl: "images/34.jpg"
            },
            {
                pattern: "Paso 35: Patrón de ejemplo para el paso 35",
                imageUrl: "images/35.jpg"
            },
            {
                pattern: "Paso 36: Patrón de ejemplo para el paso 36",
                imageUrl: "images/36.jpg"
            },
            {
                pattern: "Paso 37: Patrón de ejemplo para el paso 37",
                imageUrl: "images/37.jpg"
            },
            {
                pattern: "Paso 38: Patrón de ejemplo para el paso 38",
                imageUrl: "images/38.jpg"
            },
            {
                pattern: "Paso 39: Patrón de ejemplo para el paso 39",
                imageUrl: "images/39.jpg"
            },
            {
                pattern: "Paso 40: Este sería el Paso 40 si necesitas añadir más.",
                imageUrl: "images/40.jpg"
            }
            // --- ¡IMPORTANTE! El ÚLTIMO paso en el array NO debe llevar coma al final ---
        ];

        let currentStepIndex = 0; // El índice actual del paso (empezando desde 0)

        // Obtener referencias a los elementos del DOM
        const initialInstructions = document.getElementById('initial-instructions'); // Nueva referencia
        const stepDisplay = document.getElementById('step-display');
        const stepImage = document.getElementById('step-image');
        const patternDisplay = document.getElementById('pattern-display');
        const prevButton = document.getElementById('prev-button');
        const nextButton = document.getElementById('next-button');

        // Nuevas referencias para el modal
        const reductionType2Modal = document.getElementById('reduction-type2-modal');
        const closeModalButton = document.getElementById('close-modal-button');

        /**
         * Actualiza el contenido de la interfaz de usuario con el paso actual.
         */
        function updateUI() {
            // Lógica para mostrar/ocultar las instrucciones iniciales
            if (currentStepIndex === 0) {
                initialInstructions.classList.remove('hidden'); // Muestra las instrucciones
            } else {
                initialInstructions.classList.add('hidden'); // Oculta las instrucciones
            }

            // Actualiza el número de paso
            stepDisplay.textContent = `Paso ${currentStepIndex + 1}`;

            // Actualiza la imagen
            stepImage.src = steps[currentStepIndex].imageUrl;
            stepImage.alt = `Imagen del Paso ${currentStepIndex + 1}`;

            // Obtiene el patrón del paso actual
            const currentPatternText = steps[currentStepIndex].pattern;
            
            // ********************************************************************************
            // Lógica para hacer el texto de "Reducción Tipo 2" clickeable y mostrar el modal
            if (currentPatternText.includes("Reducción Tipo 2")) {
                // Reemplaza el texto con un span clickeable
                patternDisplay.innerHTML = currentPatternText.replace(
                    "Reducción Tipo 2",
                    "<span id='reduction-type2-link' class='text-indigo-600 font-bold cursor-pointer hover:underline'>Reducción Tipo 2</span>"
                );
                
                // Agrega el evento de clic al span recién creado
                // Es importante hacer esto DESPUÉS de haber insertado el HTML en el DOM
                const reductionLink = document.getElementById('reduction-type2-link');
                if (reductionLink) {
                    reductionLink.onclick = () => {
                        reductionType2Modal.classList.remove('hidden'); // Muestra el modal
                    };
                }
            } else {
                // Si no es un patrón de reducción, asegura que solo sea texto plano
                patternDisplay.textContent = currentPatternText;
            }
            // ********************************************************************************

            // Habilita o deshabilita los botones según el paso actual
            prevButton.disabled = currentStepIndex === 0; // Deshabilita "Anterior" en el primer paso
            prevButton.classList.toggle('opacity-50', currentStepIndex === 0);
            prevButton.classList.toggle('cursor-not-allowed', currentStepIndex === 0);
            prevButton.classList.toggle('hover:bg-gray-400', currentStepIndex !== 0);
            prevButton.classList.toggle('hover:scale-105', currentStepIndex !== 0);


            nextButton.disabled = currentStepIndex === steps.length - 1; // Deshabilita "Siguiente" en el último paso
            nextButton.classList.toggle('opacity-50', currentStepIndex === steps.length - 1);
            nextButton.classList.toggle('cursor-not-allowed', currentStepIndex === steps.length - 1);
            nextButton.classList.toggle('hover:bg-indigo-700', currentStepIndex !== steps.length - 1);
            nextButton.classList.toggle('hover:scale-105', currentStepIndex !== steps.length - 1);
        }

        // Manejador de eventos para el botón "Siguiente"
        nextButton.addEventListener('click', () => {
            if (currentStepIndex < steps.length - 1) {
                currentStepIndex++;
                updateUI();
            }
        });

        // Manejador de eventos para el botón "Anterior"
        prevButton.addEventListener('click', () => {
            if (currentStepIndex > 0) {
                currentStepIndex--;
                updateUI();
            }
        });

        // ********************************************************************************
        // Manejadores de eventos para el modal
        closeModalButton.addEventListener('click', () => {
            reductionType2Modal.classList.add('hidden'); // Oculta el modal
        });

        // Opcional: Cerrar el modal haciendo clic fuera de él
        reductionType2Modal.addEventListener('click', (event) => {
            // Solo si se hace clic directamente en el overlay (el fondo oscuro), no en el contenido del modal
            if (event.target === reductionType2Modal) { 
                reductionType2Modal.classList.add('hidden');
            }
        });
        // ********************************************************************************

        // Inicializar la UI al cargar la página
        window.onload = updateUI;
    </script>
</body>
</html>
